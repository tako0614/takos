# takos 用語明確化メモ（2025-12-02）

## 問題認識

PLAN.mdおよび実装コードで「App」という用語を多用していたため、
「複数のアプリがインストールできるプラットフォーム」のように誤解される可能性があった。

## 設計の実態

takosの設計は以下の通り：

### ✅ 正しい理解

- **1 ノード = 1 App**（ノードのプログラム本体）
- Appは「ノード全体の挙動を決めるプログラム」
- `takos-app.json` + `app/` + `app-main.ts` = ノードの本体一式
- 配布単位は `takos-distribution`（= 本体丸ごと）

### ❌ 誤解されやすいポイント

- 「App」という名前が複数形に見える
- `app/routes/`, `app/views/` が「別々のアプリ」に見える
- `App Workspace`, `AppRevision` が「複数アプリの管理」に見える

## 実際の構造

```
takos-distribution (配布単位)
  ├─ takos-core (コア機能)
  └─ App Layer (1個だけ)
       ├─ takos-app.json (ノード全体の定義)
       ├─ app/
       │   ├─ routes/      ← 1個のAppを分割しただけ
       │   ├─ views/       ← 1個のAppを分割しただけ
       │   ├─ ap/          ← 1個のAppを分割しただけ
       │   ├─ data/        ← 1個のAppを分割しただけ
       │   └─ storage/     ← 1個のAppを分割しただけ
       └─ app-main.ts (ノード全体のハンドラ実装)
```

## Anti-Platform 憲章との整合性

| 項目 | takosの実装 | プラットフォーム化の例 |
|------|------------|---------------------|
| App数 | **1個のみ** | 複数インストール可能 |
| 配布単位 | distro（本体丸ごと） | プラグイン単位 |
| 権限 | Core vs App Layer（2層） | per-app permission |
| 編集対象 | ノード全体のApp Manifest | 各プラグインの設定 |
| 追加方法 | distro全体を置き換え | プラグインを動的追加 |

→ **プラットフォーム化していない**

## 対応した改善

### 1. PLAN.md への明文化追加（5.4.1）

```markdown
##### 重要：1 ノード = 1 App の原則

takos ノードは、**常に App を 1 個だけ持つ**。

* ノード内に複数の App（プラグイン等）を動的に追加・削除することは仕様上想定しない。
* ここでいう「App」は「**ノードのプログラム本体**」という意味
* `app/routes/*.json` などは、**1 つの App をモジュールごとにファイル分割したもの**
```

### 2. 実装コードへのコメント追加

全てのサービスAPIファイルに以下を追記：

```typescript
/**
 * 注: ここでいう「App」は「ノードのプログラム本体（1ノード=1App）」を指し、
 * プラグインや複数インストール可能なアプリではありません。
 */
```

### 3. IMPLEMENTATION_SUMMARY.md への注記

実装サマリーの冒頭に前提を明記：

```markdown
**重要な前提**：ここでいう「App」は「**ノードのプログラム本体**」を指します。
takosノードは常にApp を1個だけ持ち、複数のアプリがインストールされるプラットフォームではありません。
```

## 今後の方針

### 用語の使い方

- **「App」** = ノードのプログラム本体（singular）
- **「App Layer」** = Core Kernelの対となる層
- **「App Script」** = ノード全体のハンドラ実装
- **「App Workspace」** = 1個のAppの作業コピー（dev用）
- **「AppRevision」** = 1個のAppの履歴

### 代替案の検討（必要に応じて）

もし今後さらに明確化したい場合：

- `App Manifest` → `Node Manifest`
- `App Script` → `Node Script` または `Runtime Script`
- `App Workspace` → `Node Workspace`
- `AppRevision` → `NodeRevision`

ただし、現時点では **PLAN.mdに明文化を追加した時点で十分明確** なので、
大規模な用語変更は不要と判断。

## まとめ

- **設計**: 1ノード=1App で Anti-Platform を維持
- **課題**: 用語の見え方が「複数アプリ」っぽかった
- **対応**: PLAN.md + コード + ドキュメントに明文化追加
- **結果**: 誤解を防ぐ説明が整備された

**重要**: takosは「複数アプリが動くプラットフォーム」ではなく、
「1つのノードプログラムを構造化して管理する仕組み」である。
